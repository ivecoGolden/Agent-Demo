# 提示词自动评估体系（以豆包输出为参考）

## 🎯 评估目标

通过自动化手段对提示词生成的模型输出进行定量评估，衡量其是否贴近“豆包风格”的高质量对话体验，并据此实现提示词优化闭环。

---

## 🧭 当前启用的核心评估维度（每项评分均为 1~5 分）

### 1. 语义相似度（semantic_similarity）

- 描述：模型输出与豆包输出在语义内容上的相似程度。
- 实现方式：使用 DashScope embedding，计算余弦相似度并映射到 1~5 分数段。

```python
sim = cosine_similarity(embed(bean_output), embed(model_output))
score = round(sim * 5)
```

### 2. 拟人化程度（human_likeness）

- 描述：模型回复是否具有自然、亲切、共情的语气，是否像一个会安慰人的朋友在对话。
- 实现方式：以豆包输出为满分参考，调用通义大模型对模型输出与豆包输出进行风格对比评分，生成 1~5 分。

```python
prompt = f"豆包回复：{bean_output}\n模型回复：{model_output}\n请从1到5分打分，判断模型回复是否具备豆包的拟人化风格。"
score = call_qwen_model(prompt)
```

### 3. 清晰度（clarity）

- 描述：输出是否语言通顺、结构清晰、表达逻辑自然。
- 实现方式：以豆包输出为清晰表达的参考，调用通义大模型对模型输出与豆包表达进行清晰度对比评分。

```python
prompt = f"豆包回复：{bean_output}\n模型回复：{model_output}\n请从1到5分打分，判断模型回复在语言清晰度方面与豆包的差距。"
score = call_qwen_model(prompt)
```

### 4. 简洁度（conciseness）

- 描述：模型回复是否表达紧凑、不啰嗦，是否避免冗余、重复信息。
- 实现方式：以豆包输出为参考，调用通义大模型判断模型回复是否存在语言冗余、赘述情况，按 1~5 分评分。

```python
prompt = f"豆包回复：{bean_output}\n模型回复：{model_output}\n请从1到5分判断模型回复在语言是否简洁、是否存在重复或啰嗦。"
score = call_qwen_model(prompt)
```

### 5. 偏题程度（on_topic）

- 描述：模型是否偏离用户意图，是否答非所问，相比豆包输出是否保持同一话题中心。
- 实现方式：以豆包输出为完整回答参考，结合用户输入、豆包回复、模型输出，调用通义大模型判断偏题程度（越接近豆包，得分越高）。

```python
prompt = f"用户说：{input_text}\n豆包：{bean_output}\n模型：{model_output}\n请从1到5分判断模型回复在话题聚焦度上是否接近豆包回复。"
score = call_qwen_model(prompt)
```

---

## 📊 综合评分计算

每轮评估记录包含：

- 用户输入（input）
- 模型输出（model_output）
- 豆包参考输出（bean_output）
- 各项维度评分（1~5 分）
- 总评分（四项平均分，保留两位小数）

---

## 🧠 一次性整合评估方案（节省模型调用）

为了减少通义大模型调用次数，可将以下 4 个维度（2~5）整合到一次请求中评估：

- 拟人化程度（human_likeness）
- 清晰度（clarity）
- 简洁度（conciseness）
- 偏题程度（on_topic）

### 提示词模板示例：

```python
prompt = f"""
请你以评分专家身份，基于以下上下文内容，对 AI 回复进行以下四个方面的评分，范围为 1~5 分（整数）：

1. 拟人化程度：是否自然亲切、像会安慰人的朋友？
2. 清晰度：语言是否通顺、逻辑是否清晰？
3. 简洁度：是否表达紧凑、不啰嗦？
4. 偏题程度：是否答题，是否与豆包回复保持相近主题？

用户输入：{input_text}
豆包回复：{bean_output}
模型回复：{model_output}

请按如下 JSON 格式返回评分结果：
{{"human_likeness": X, "clarity": X, "conciseness": X, "on_topic": X}}
"""
```

通过一次调用返回所有维度评分，节省模型交互成本，适用于大批量评估场景。

---

## 📋 评估结果输出示例表格

评估程序运行结束后将输出类似如下表格结果，用于分析模型输出质量与提示词版本对比：

| 输入内容       | 模型输出               | 豆包输出               | 相似度 | 拟人化 | 清晰度 | 偏题程度 | 总分 |
| -------------- | ---------------------- | ---------------------- | ------ | ------ | ------ | -------- | ---- |
| 我今天心情不好 | 别太自责，早点休息吧～ | 不开心的时候可以聊聊天 | 4      | 5      | 5      | 4        | 4.5  |

说明：

- 每项维度评分为整数（1~5）
- 总分为四项平均分，保留两位小数
