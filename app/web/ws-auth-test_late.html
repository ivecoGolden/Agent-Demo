<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>WebSocket Auth æµ‹è¯•</title>
  </head>
  <body>
    <h2>WebSocket Auth èŠå¤©æµ‹è¯•</h2>

    <label>Token: <input type="text" id="token" style="width: 400px" /></label
    ><br />
    <label>UUID: <input type="text" id="uuid" value="uuid-001" /></label><br />
    <label>æ–‡å­—å†…å®¹: <input type="text" id="text" value="ä½ å¥½" /></label><br />
    <label>å›¾ç‰‡åœ°å€ï¼ˆå¯ç©ºï¼‰: <input type="text" id="image" /></label><br />
    <button onclick="connect()">è¿æ¥</button>
    <button onclick="sendMessage()">å‘é€æ¶ˆæ¯</button>

    <pre
      id="log"
      style="
        background: #eee;
        padding: 1em;
        max-height: 300px;
        overflow-y: scroll;
      "
    ></pre>

    <script>
      let socket;

      function log(message) {
        const logEl = document.getElementById("log");
        logEl.textContent += message + "\n";
        logEl.scrollTop = logEl.scrollHeight;
      }

      function connect() {
        const token = document.getElementById("token").value;

        if (socket && socket.readyState === WebSocket.OPEN) {
          socket.close();
        }

        // const wsUrl = `wss://dev.moguangkeji.com/ws-auth-late`;
        const wsUrl = `ws://localhost:7001/ws-auth-late`;
        socket = new WebSocket(wsUrl);

        socket.onopen = () => {
          log("âœ… å·²è¿æ¥");
          const authMessage = {
            token: token,
          };
          socket.send(JSON.stringify(authMessage));
          log("ğŸ” å‘é€èº«ä»½éªŒè¯ä¿¡æ¯: " + JSON.stringify(authMessage));
        };
        socket.onmessage = (event) => log("ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: " + event.data);
        socket.onclose = () => log("âŒ è¿æ¥å…³é—­");
        socket.onerror = (error) => log("âš ï¸ é”™è¯¯: " + error);
      }

      function sendMessage() {
        const uuid = document.getElementById("uuid").value;
        const text = document.getElementById("text").value;
        const image = document.getElementById("image").value;

        const message = {
          uuid: uuid,
          text: text,
          image: image,
          video: "", // ç•™ç©º
        };

        if (socket && socket.readyState === WebSocket.OPEN) {
          socket.send(JSON.stringify(message));
          log("ğŸ“¤ å‘é€æ¶ˆæ¯: " + JSON.stringify(message));
        } else {
          log("â— WebSocket æœªè¿æ¥");
        }
      }
    </script>
  </body>
</html>
